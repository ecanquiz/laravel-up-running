import{_ as s,c as a,o as e,V as i}from"./chunks/framework.D9sOcAzr.js";const E=JSON.parse('{"title":"Protección CSRF","description":"","frontmatter":{},"headers":[],"relativePath":"routing-and-controllers/csrf-protection.md","filePath":"routing-and-controllers/csrf-protection.md"}'),t={name:"routing-and-controllers/csrf-protection.md"},n=i(`<h1 id="proteccion-csrf" tabindex="-1">Protección CSRF <a class="header-anchor" href="#proteccion-csrf" aria-label="Permalink to &quot;Protección CSRF&quot;">​</a></h1><p>Si ya ha intentado enviar un formulario en una aplicación de Laravel, incluida la del <a href="./form-method-spoofing.html#suplantacion-de-metodos-http-en-formularios-html">ejemplo anterior</a>, es probable que se haya encontrado con la temida <code>TokenMismatchException</code>.</p><p>De manera predeterminada, todas las rutas en Laravel, excepto las rutas de &quot;solo lectura&quot; (aquellas que usan <code>GET</code>, <code>HEAD</code> u <code>OPTIONS</code>), están protegidas contra ataques de falsificación de solicitud entre sitios (CSRF) al requerir que se pase un token, en forma de una entrada llamada <code>_token</code>, junto con cada solicitud. Este token se genera al comienzo de cada sesión, y cada ruta que no sea de solo lectura compara el <code>_token</code> enviado con el token de la sesión.</p><div class="info custom-block"><p class="custom-block-title">¿Qué es CSRF? (<em>cross-site request forgery</em>)</p><p>Una <em>falsificación de solicitud entre sitios</em> es cuando un sitio web se hace pasar por otro. El objetivo es que alguien secuestre el acceso de sus usuarios a su sitio web enviando formularios desde su sitio web al suyo a través del navegador del usuario que ha iniciado sesión.</p><p>La mejor forma de evitar los ataques CSRF es proteger todas las rutas entrantes (<code>POST</code>, <code>DELETE</code>, etc.) con un token, algo que Laravel hace fuera de caja.</p></div><p>Tiene dos opciones para evitar este error CSRF. El primer método, y el preferido, es agregar la entrada <code>_token</code> a cada uno de sus envíos. En los formularios HTML, hay una forma sencilla de hacerlo, como puede ver en el ejemplo siguiente.</p><p><em>Tokens CSRF</em></p><div class="language-html vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">html</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">form</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> action</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/tasks/5&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> method</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;POST&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @csrf</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">form</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span></code></pre></div><p>En las aplicaciones de JavaScript, requiere un poco más de trabajo, pero no mucho. La solución más común para los sitios que utilizan marcos de JavaScript es almacenar el token en cada página en una etiqueta <code>&lt;meta&gt;</code> como esta:</p><div class="language-html vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">html</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">meta</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;csrf-token&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> content</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#B31D28;--shiki-dark:#FDAEB7;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">?php echo csrf_token(); ?&gt;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span></code></pre></div><p>Almacenar el token en una etiqueta <code>&lt;meta&gt;</code> facilita vincularlo al encabezado HTTP correcto, lo que puede hacer una vez de manera global para todas las solicitudes de su marco de JavaScript, como en el ejemplo siguiente.</p><p><em>Vinculación global de un encabezado para CSRF</em></p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// In jQuery:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ajaxSetup</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    headers: {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &#39;X-CSRF-TOKEN&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;meta[name=&quot;csrf-token&quot;]&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">attr</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;content&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// With Axios: it automatically retrieves it from a cookie. Nothing to do!</span></span></code></pre></div><p>Laravel verificará el <code>X-CSRF-TOKEN</code> (y el <code>X-XSRF-TOKEN</code>, que usan Axios y otros frameworks de JavaScript como Angular) en cada solicitud, y los tokens válidos pasados ​​allí marcarán la protección CSRF como satisfecha.</p><div class="info custom-block"><p class="custom-block-title">Vincular tokens CSRF con Vue Resource</p><p>La incorporación del token CSRF a Vue Resource es un poco diferente a la de Laravel; consulte la <a href="https://github.com/pagekit/vue-resource/tree/develop/docs#documentation" target="_blank" rel="noreferrer">documentación de Vue Resource</a> para ver ejemplos.</p></div>`,14),o=[n];function l(r,c,p,d,h,k){return e(),a("div",null,o)}const g=s(t,[["render",l]]);export{E as __pageData,g as default};
